* SPARTAN EMACS

Finally, a simple base Emacs configuration framework

** FEATURES

- KISS, clean configuration and a comprehensible layers system with minimal abstraction, (easy to hack on to make it "yours.")
- Uses lightweight, mostly-vanilla configured layer packages
- Straight + use-package version version pinning for greater stability (pins are updated here approximately once a month.)
- Popular langs come with optional layers that are preconfigured with eglot LSP and company mode
- Project Awareness is available with Projectile, and Magit
- Everything is deferred as much as is reasonable, for <1 second initial load times with all layers enabled
- Choose between holy or evil mode
- Vertico minibuffer completion
- Tested on Linux, but should work also work fine anywhere for the most part.
- Tuned for ultimate performance using the latest *gccemacs* with native *json* parsing with *eglot* language server protocol  (not required, just recommended.)
- *Treesitter* [optional] support. All you need is libtree-sitter-dev and emacs 29 compiled --with-tree-sitter support

  Spartan Emacs is not a starter kit. It does not teach Emacs. If you are new, and please begin by checking out ~M-x help-with-tutorial~.
  ~M-x~ means (~Alt~ + ~x~) and then ~help-with-tutorial~ Return (enter) to begin. One might follow up with ~An Introduction to Programming in Emacs Lisp~
  additionally. The manuals may all be found at https://www.gnu.org/software/emacs/manual/

  [[spartan-theme.png]]

*** QUICK INSTALL

#+BEGIN_SRC bash
  git clone https://github.com/a-schaefers/spartan-emacs.git ~/.emacs.d
#+END_SRC

*** HOW TO UPDATE

Layers use pinned packages via Straight.el and are periodically updated.

1. *git pull*

2. *M-x straight-thaw-versions*

3. *Restart Emacs*

*** LAYERS

- Edit ~.emacs.d/spartan.el~ to configure the theme, fonts, and  additional language layers, then restart

**** HOW LAYERS WORK

1. init.el (among other things) auto-generates a default ~/.emacs.d/spartan.el

   This configuration file is not stored in our Git, but you might want to add it in to yours.

   It may freely be modified by the user, but keep in mind it loads early, before the layers.

2. Enabled layer packages are loaded after ~/.emacs.d/spartan.el

3. Layer packages may be again customized in ~/.emacs.d/spartan.d/ with any additional setup or overrides

   (all lisp files in spartan.d/ auto load last, during the emacs-startup-hook)

*** MINIMAL LANGUAGE LAYERS PRECONFIGURED

The idea here is to provide everywhere the get up and going configuration, this means proper syntax support,
auto-completion and find definition, etc. via eglot's minimal language server protocol implementation.
Some of the language modes also include repls. Debugging is provided within many of the languages themselves,
e.g. Python has pdb. With C, one may use ~M-x gdb~, etc.

With compiled languages, one might use M-x cc and set the compile-command to something instead of make if needed, etc.

To enable LSP for a language layer that supports it, note the external package you will need from below.
If the LSP executable is on your PATH and the language layer is active, then ~eglot~ is going to automatically initialize it.

- Bash  (shellcheck)
- C (clang and clangd)
- Clojure (n/a cider)
- Common Lisp (n/a)
- Elixir (elixir-ls)
- Erlang (erlang_ls)
- Emacs Lisp (n/a)
- Forth (forth-lsp)
- Go (gopls)
- Haskell (hls)
- HTML / CSS (vscode-html-language-server, vscode-css-language-server)
- Javascript / Typescript (typescript-language-server)
- Lua (lua-language-server)
- Nix (rnix-lsp)
- Ocaml (ocaml-lsp)
- Php (php-language-server) Note: ~M-x eglot~ manually or use ~(setq spartan-php-langserver t)~ for auto-starting eglot
- Python (pylsp)
- Racket (racket-langserver) Note: ~M-x eglot~ manually or use ~(setq spartan-racket-langserver t)~ for auto-starting eglot
- Ruby (solargraph)
- Rust (rust-analyzer)
- Schemes (n/a)
- Terraform (terraform-ls)
- Zig (zls)

Note: There is a spartan-paredit layer which will optionally activate for all of the schemes and lisps.

*** BINDS

- Default emacs binds (unless you enable evil.)

- Short M-x aliases

  - M-x git  (magit)
  - M-x pro  (projectile-commander)
  - M-x sh   (better-shell)
  - M-x lint (flymake)
  - M-x cc   (compile-command)
  - etc...

- Also see [[https://github.com/a-schaefers/spartan-emacs/blob/master/spartan-layers/spartan-eglot.el][spartan-eglot.el]] for language-server-protocol binds under the M- prefix.

- Language mode specifc binds should be handled by the mode upstream or by the individual user.

- Overrides go in ~.emacs.d/spartan.d/~

*** Compile your own Emacs

If you're on ubuntu or debian, this should compile Emacs 29 with native compile support, etc.
I recommend this because it's fun and educational, and it'll keep you rolling on the recent Emacs releases,
even when your distro isn't.

#+BEGIN_SRC bash
  # First determine your gcc version with gcc --version,
  # then modify libgccjit-12-dev below to the major version number you have...
  sudo apt install \
  build-essential \
  autoconf \
  libgtk-3-dev \
  libgnutls28-dev \
  libtiff5-dev \
  libgif-dev \
  librsvg2-dev \
  libjpeg-dev \
  libwebp-dev \
  libxml2-dev \
  libpng-dev \
  libxpm-dev \
  libncurses-dev \
  texinfo \
  libjansson4 \
  libjansson-dev \
  libgccjit0 \
  libgccjit-12-dev \
  libtree-sitter-dev

  # Clone repo, checkout relevant branch at time of this writing
  git clone git://git.sv.gnu.org/emacs.git
  git checkout emacs-29
  cd emacs

  # Generate makefile
  ./autogen.sh

  # set your c compiler to again be the major version of gcc on your system
  export CC=/usr/bin/gcc-12 CXX=/usr/bin/gcc-12

  # configure with the flags you want to build with
  ./configure --with-native-compilation \
  --with-json \
  --with-pgtk \
  --with-rsvg \
  --with-gnutls \
  --without-xwidgets \
  --without-xaw3d \
  --with-mailutils \
  --with-tree-sitter

  # compile it
  make -j"$(nproc)"

  # start emacs (test)
  ./src/emacs

  # From here, one could add a bash alias to the compiled executable in the HOME directory, e.g.
  # alias emacs=~/repos/emacs/src/emacs
  # OR, one could opt to just install it...
  # sudo make install   # to clobber it all over your system
  # sudo make uninstall # should do a decent enough cleanup job
  # to update, it might be necessary to clean it before pulling the repo and running through the entire process again
  # make clean
  # git clean -fdx
#+END_SRC

***** /On Ergonomics and the dreaded "Emacs Pinky" -- A wholistic approach/

I am passionate about using good ergonomics to extend the life and health of our fingers and wrists as programmers.

A major contributing factor to RSI is programming is the use of modifiers, which Emacs makes heavy use of by default.

0. Start with a mechanical keyboard.

   For this, I also would recommend a board with cherry blue or gateron blue keys, or perhaps browns. So do a little research.

1. Evil mode

   Evil-mode users avoid much of the issue entirely, things to be aware of:
   - twisting your left wrist while pressing the escape key.
   - the famous caps escape swap, this can be damaging to the left pinky finger.
   - overuse with hjkl, when you should be using more 'w''e' and 'b', '/' etc.

2. Holy mode (standard Emacs binds)

   Karate chops.

   I recommend here the use of karate chop control presses via a 60% keyboard, this enables you to keep your wrist straight while using modifiers.

   *OR*

   Swap left Alt with left Control.

   If karate chopping your control keys is not for you, I recommend this keyswap instead.

   Swapping left alt with left control enables the user to hold the control modifier with the left thumb, and the right alt modifier (in its natural position) with the right thumb.
   The result of this simple keyswap is that it is now possible to use both modifiers without holding them with the pinky or tweaking the wrists.
   This keyswap is available in Gnome and accessible with the Gnome-Tweaks tool, and other Desktops have their own methods, too.

3. Try lifting weights

   It's amazing what a little bit of moderate exercise can do for the programmer's RSI. Try some curls and upright rows, military press and lateral pull-downs. 15 minutes a day might be all you need.

4. Diet and sleep

   This goes without saying and is out of scope, but do some research and try some things to improve in these areas -- it should help!

****** Disclaimer
   Please consult your physician for personalized medical advice.
   Always seek the advice of a physician or other qualified healthcare provider with any questions regarding a medical condition.
   Never disregard or delay seeking professional medical advice or treatment because of something you have read here.
